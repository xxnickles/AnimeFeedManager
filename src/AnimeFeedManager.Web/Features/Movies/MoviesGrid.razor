@page "/{Season}/movies"
@using AnimeFeedManager.Features.Movies.Library
@inject MoviesLibraryGetter LibraryGetter;
@inject ILogger<MoviesGrid> Logger;

<PageTitle>@PageTitleForSeason(SeriesType.Movie, _selectedSeason)</PageTitle>

<SeriesGrid Series="_seasonCollection.Animes" SeriesType="SeriesType.Movie"></SeriesGrid>

@code {

    [Parameter] public string Season { get; set; } = string.Empty;

    private SeasonInformation _selectedSeason = new DefaultSeasonInformation();

    private ShortSeasonCollection _seasonCollection = new EmptyShortSeasonCollection();

    protected override async Task OnInitializedAsync()
    {
        _selectedSeason = SeasonValidators.Parse(Season)
            .Match(
                values => new SeasonInformation(values.season, values.year),
                _ => new DefaultSeasonInformation()
            );


        var results = await LibraryGetter.GetForSeason(_selectedSeason.Season, _selectedSeason.Year).LogErrors(Logger);
        _seasonCollection = results.Match(
            collection => collection,
            _ => new EmptyShortSeasonCollection()
        );
    }

}